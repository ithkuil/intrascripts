(function(){var a=this;window.Walker=function(){return{initWalker:function(){a.state={forward:!1,left:!1,right:!1,back:!1,isOnObject:!1,canJump:!1,jumping:!1};if(a.camera!=null)return window.document.addEventListener("keydown",a.onKeyDown,!1),window.document.addEventListener("keyup",a.onKeyUp,!1)},handleKeys:function(b,c){switch(b.keyCode){case 38:case 87:return a.setState("forward",c);case 37:case 65:return a.setState("left",c);case 40:case 83:return a.setState("back",c);case 39:case 68:return a.setState("right",c);case 32:return a.jump()}},onKeyDown:function(b){return b.keyCode===32?a.jump():a.handleKeys(b,!0)},jump:function(){if(a.state.canJump)return a.velocity.y+=10,setState("jumping",!0),setState("canJump",!1)},onKeyUp:function(a){return this.handleKeys(a,!1)}}}}).call(this),function(){var a=this;window.Looker=function(){return{initLooker:function(){if(a.camera!=null)return window.document.addEventListener("mousemove",a.onMouseMove,!1)},onMouseMove:function(a){if(!this.enabled)return;return this.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,this.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0,this.yawObject.rotation.y-=this.movementX*.002,this.pitchObject.rotation.x-=this.movementY*.002,this.pitchObject.rotation.x=Math.max(-this.PI_2,Math.min(this.PI_2,this.pitchObject.rotation.x))}}}}.call(this),function(){window.Mover=function(){return{initMover:function(){return this.pitchObject=new THREE.Object3D,this.camera!=null&&this.pitchObject.add(this.camera),this.yawObject=new THREE.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject),this.velocity=new THREE.Vector3,this.acceleration=new THREE.Vector3,this.PI_2=Math.PI/2,this.enabled=!1}}}}.call(this),function(){window.StateBroadcaster={initStateBroadcaster:function(){return this.listeners=[]},setState:function(a,b){var c,d,e,f,g=[];this.state[a]=b;for(c=0,e=(d=this.listeners).length;c<e;++c)f=d[c],g.push(f(a,b));return g}}}.call(this),function(){function d(a,b,c){return function(){return(c||a)[b].apply(a,arguments)}}function e(a,b){for(var c in b)a[c]=b[c];return a}var a,b,c;a=window.Looker,b=window.Mover,window.Avatar=c=function(){function c(){this.update=d(this,"update",a),this.getObject=d(this,"getObject",a),this.init=d(this,"init",a),this.isOnObject=d(this,"isOnObject",a),this.constructor=d(this,"constructor",a)}c.displayName="Avatar";var a=c.prototype,b=c;return e(a,arguments[0]),e(a,arguments[1]),e(a,arguments[2]),e(a,arguments[3]),a.constructor=function(a){return this.camera=a,this.init()},a.isOnObject=function(a){return this.isOnObject=a,this.canJump=a},a.init=function(){return this.listeners=[],this.initLooker(),this.initMover(),this.initWalker(),this.initStateBroadcaster()},a.getObject=function(){return this.yawObject},a.update=function(a){if(!this.enabled)return;a*=.1,this.velocity.x+=(function(a){return a-this.velocity.x})*.08*a,this.velocity.z+=(function(a){return a-this.velocity.z})*.08*a,this.velocity.y-=.25*a,this.state.forward&&(this.velocity.z-=.12*a),this.state.back&&(this.velocity.z+=.12*a),this.state.left&&(this.velocity.x-=.12*a),this.state.right&&(this.velocity.x+=.12*a),this.state.isOnObject&&(this.velocity.y=Math.max(0,this.velocity.y)),this.yawObject.translateX(this.velocity.x),this.yawObject.translateY(this.velocity.y),this.yawObject.translateZ(this.velocity.z);if(this.yawObject.position.y<10)return this.velocity.y=0,this.yawObject.position.y=10,this.state.canJump=!0},c}(b,a,Walker,StateBroadcaster)}.call(this);